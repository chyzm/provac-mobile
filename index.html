<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provac Maps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
     <!-- Leaflet css, from the leaflet documentation site -->
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    

     <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                        // Add CSS variables for text colors
                        text: {
                            DEFAULT: 'var(--text-color)',
                            dark: 'var(--text-color-dark)',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        html, body{
            height: auto;
            margin: 0;
            padding: 0;
            overflow: hidden
          
        }

        html {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        :root {
            --text-color: #1f2937; /* gray-800 */
            --text-color-dark: #f9fafb; /* gray-50 */
        }
        
        .dark {
            --text-color: #f9fafb; /* gray-50 */
            --text-color-dark: #1f2937; /* gray-800 */
        }
        
        /* Apply to all text elements */
        body {
            color: var(--text-color);
        }
        
        /* Smooth transitions */
        html, body, * {
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        
        #map{
            height: 100%;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;  /* Added this to fix white margin */
            right: 0; /* Added this to fix white margin */
            width: 100%; /* Added this to fix white margin */
        }
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-hidden {
            transform: translateX(-100%);
            
        }
        .sidebar-visible {
            transform: translateX(0);
        }
        /* Prevent scrolling when sidebar is open */
        body.sidebar-open {
            overflow: hidden;
        }

        .modal-open {
            overflow: hidden;
        }
        /* Mobile-first container */
        .container-mobile {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        /* Dropdown styles */
        .dropdown-menu {
            position: absolute;
            right: 0.5rem;
            top: 3rem;
            width: 200px;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 40;
            display: none;
        }
        .dropdown-menu.left {
            right: auto;
            left: 0.5rem;
        }
        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #374151;
            font-weight: 500;
        }
        .dropdown-menu a:hover {
            background-color: #f3f4f6;
        }
        .dropdown-divider {
            border-top: 1px solid #e5e7eb;
            margin: 0.25rem 0;
        }
        /* Projects panel transition */
        .projects-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80vh;
            background: white;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            z-index: 50;
            overflow-y: auto;
        }
        .projects-panel-visible {
            transform: translateY(0);
        }
        .projects-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
        }

        #sidebarOverlay {
            position: fixed;
            top: 4rem; /* Height of the header */
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        /* New project */
     #createProjectModal {
    transition: opacity 0.3s ease;
}

#createProjectAttributeModal{
    transition: opacity 0.3s ease;
}

#createLayerModal{
    transition: opacity 0.3s ease;
}

.map-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    
}

.map-icon i {
    font-size: 0.75rem;
}

/* For the vertical icons */
.vertical-icons-container {
    writing-mode: vertical-rl;
    text-orientation: mixed;
}
        
    </style>
</head>
<body class="font-sans bg-gray-100 text-[var(--text-color)] dark:bg-gray-900">
    <!-- App Container -->
    <div class="flex flex-col h-screen overflow-hidden">
        <!-- Fixed Header -->
        <header class="bg-blue-900 dark:bg-gray-700 text-white py-4 px-0 shadow-md fixed top-0 left-0 right-0 z-30 ">
            <div class="container-mobile flex items-center justify-between mx-auto">
                <!-- Logo/Sidebar Toggle -->
                <button id="sidebarToggle" class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-secondary">
                    <h1 class="text-2xl font-bold text-white tracking-tight ml-10">
                        <span class="text-blue-400">Pro</span><span class="text-orange-400">vac</span>
                    </h1>
                </button>

                <div class="pr-4"></div>
                
                <!-- Icons on the right -->
                <div class="flex items-center space-x-2">

              



                    <!-- Layers Icon -->
                    <button class="p-1 rounded-full hover:bg-secondary" onclick="showLayerPanel()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 7l9-4 9 4-9 4-9-4z"/>
                            <path d="M3 12l9 4 9-4"/>
                            <path d="M3 17l9 4 9-4"/>
                        </svg>
                    </button>
                    
                    <!-- Line Plotting Icon with Dropdown -->
                    <div class="relative" >
                        <button id="linePlottingMenu" class="py-1 px-0 rounded-full hover:bg-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="32" viewBox="0 0 64 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="8" cy="16" r="2" fill="#007BFF"/>
                                <circle cx="20" cy="8" r="2" fill="#007BFF"/>
                                <circle cx="36" cy="12" r="2" fill="#007BFF"/>
                                <circle cx="48" cy="4" r="2" fill="#007BFF"/>
                                <path d="M8 16 L20 8 L36 12 L48 4" />
                            </svg>
                        </button>
                        
                        <!-- Line Plotting Dropdown Menu -->
                        <div id="linePlottingDropdown" class="dropdown-menu">
                            <a href="#" onclick="showFeatureLayerPanel()">Record Feature</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="showTrackPanel()">Record Track</a>
                          </div>
                          
                    </div>
                    
                    <!-- Hamburger Menu Icon with Dropdown -->
                    <div class="relative">
                        <button id="hamburgerMenu" class="py-1 px-0 rounded-full hover:bg-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round">
                                <line x1="4" y1="6" x2="20" y2="6"/>
                                <line x1="4" y1="12" x2="20" y2="12"/>
                                <line x1="4" y1="18" x2="20" y2="18"/>
                            </svg>
                        </button>
                        
                        <!-- Hamburger Dropdown Menu -->
                        <div id="hamburgerDropdown" class="dropdown-menu">
                            <a href="#" onclick="showProjectsPanel()">Projects</a>
                            <a href="#" onclick="triggerCamera()">Take new Photo</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="showPage('loginPage')">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

       <!-- Sidebar - Overlay version -->
       <aside id="sidebar" class="sidebar-transition  sidebar-hidden w-64 bg-black text-light fixed top-16 left-0 bottom-0 z-20 overflow-y-auto  shadow-xl">
        <div class="p-4">
            <!-- Project Section -->
            <div class="mb-6">
                <div class="flex items-center mb-2 space-x-2 cursor-pointer" onclick="showProjectsPanel()">
                    <img src="/img/projects.jpg" alt="projects" class="w-6 h-6">
                    <h2 class="text-lg font-semibold text-white">Projects</h2>
                  </div>

                  <div class="flex items-center mb-2 space-x-2 cursor-pointer" onclick="showprojectAttributesPanel()">
                    <img src="/img/projects.jpg" alt="projects" class="w-6 h-6">
                    <h2 class="text-lg font-semibold text-white">Project Attributes</h2>
                  </div>

                  <div class="flex items-center mb-2 space-x-2 cursor-pointer" onclick="showLayerPanel()">
                    <img src="/img/layers.jpg" alt="projects" class="w-6 h-6">
                    <h2 class="text-lg font-semibold text-white">Layers</h2>
                  </div>

                  <div class="flex items-center mb-2 space-x-2 cursor-pointer" onclick="showSearchPanel()">
                    <img src="/img/search.jpg" alt="projects" class="w-6 h-6">
                    <h2 class="text-lg font-semibold text-white">Search</h2>
                  </div>


                
              <!--<ul class="space-y-2">
                    <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Project Attributes</a></li>
                    <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Layers</a></li>
                    <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Search</a></li>
                </ul>-->
            </div>
            
            <!-- GNSS Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">GNSS</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/bluetooth.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="showBluetoothGnssPanel()">Bluetooth GNSS</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/gnss_status.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="showGnssStatusPanel()">GNSS Status</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/skyplot.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Skyplot</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/ntrip.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="showNtripClientPanel()">NTRIP Client</a></li>
                      </div> 
                </ul>
            </div>
            
            <!-- Record Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">Record</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/feature.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="showFeatureLayerPanel()">Feature</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/track.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="showTrackPanel()">Track</a></li>
                      </div>
                       <!--Open Camera on Mobile-->
                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/photo.jpg" alt="projects" class="w-6 h-6">
                        <li>
                          <a href="#" class="block px-3 py-2 rounded hover:bg-gray-700" onclick="triggerCamera()">Photo</a>
                        </li>
                      </div>
                      
                      <!-- Hidden file input -->
                      <input type="file" accept="image/*" capture="environment" id="cameraInput" style="display:none" onchange="handlePhoto(this.files)">
                      
                      <script>
                        function triggerCamera() {
                          document.getElementById('cameraInput').click();
                        }
                      
                        function handlePhoto(files) {
                          if (files.length > 0) {
                            const file = files[0];
                            // Optional: preview, upload, or handle the photo
                            console.log('Photo captured:', file);
                          }
                        }
                      </script>
                      
                </ul>
            </div>
            
            <!-- Import Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">Import</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/import-project.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Import Project</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/import-templates.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Import Template</a></li>
                      </div>
                </ul>
            </div>

            <!-- Share/Export Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">Share / Export Project</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/share.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Share</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/export.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Export</a></li>
                      </div> 
                </ul>
            </div>

            <!-- Templates Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">Templates</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/share-template.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Share Template</a></li>
                      </div> 

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/export-template.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Export Template</a></li>
                      </div>
                </ul>
            </div>

            <!-- Other Section -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 text-white">Other</h2>
                <ul class="space-y-2">
                    <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/compass.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Compass</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/settings.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">Settings</a></li>
                      </div>

                      <div class="flex items-center mb-2 space-x-2">
                        <img src="/img/about.jpg" alt="projects" class="w-6 h-6">
                        <li><a href="#" class="block px-3 py-2 rounded hover:bg-gray-700">About</a></li>
                      </div>
                </ul>
                <br>
                       <!-- Dark Mode Toggle -->
            <button id="darkModeToggle" class="p-1 rounded-full hover:bg-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-300 dark:text-yellow-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path id="darkModeIcon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            </button>
            </div>


        </div>
     </aside>

        <!-- Overlay when sidebar is open -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden"></div>

        <!-- Projects Panel (hidden by default) -->
                <div id="projectsPanel" class="projects-panel dark:bg-gray-800">
                    <div class="p-4">
                    <!-- Header row with "new" and close -->
                    <div class="flex justify-between items-center mb-4">
                        <!-- New link with plus icon -->
                        <a href="#" class="text-blue-600 font-semibold flex items-center space-x-1" onclick="showCreateProjectModal()">
                            <span class="text-xl">+</span>
                            <span>New</span>
                        </a>

                        <h2 class="text-xl font-semibold  text-center" style="margin-right:30px;">Projects</h2>

                
                        <!-- Close button -->
                        <button onclick="hideProjectsPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
                    </div>
                
                    <!-- Panel drag handle -->
                    <div class="flex justify-center mb-2">
                        <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
                    </div>
                
                    
                
                    <!-- Filter section -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Filter</h3>
                        <input class="w-full text-gray-700 bg-gray-100 p-3 rounded-lg" type="text" name="filter" placeholder="Filter projects">
                    </div>
                
                
                  
                    </div>
                </div>

                <!-- Project Attributes Panel (hidden by default) -->
                    <div id="projectAttributesPanel" class="projects-panel dark:bg-gray-800">
                        <div class="p-4">
                            <!-- Header row with title and buttons -->
                            <div class="flex justify-between items-center mb-4">
                                <!--  add buttons-->
                                <a href="#" class="text-blue-600 font-semibold flex items-center space-x-1" onclick="showCreateProjectAttributeModal()">
                                    <span class="text-xl">+</span>
                                    
                                </a>

                                <h2 class="text-xl font-semibold text-center">Project Attributes</h2>

                                <!-- Save and Close buttons -->
                                <div class="flex items-center space-x-4">
                                    <button onclick="saveProjectAttributes()" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-download"></i>

                                    </button>
                                    <button onclick="hideProjectAttributesPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
                                </div>
                            </div>

                            <!-- Panel drag handle -->
                            <div class="flex justify-center mb-2">
                                <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
                            </div>

                            <!-- Content area (add your project attributes form here) -->
                            
                        </div>
                    </div>

                    <!-- Layers panel (hidden by default) -->
                    <div id="layerPanel" class="projects-panel dark:bg-gray-800">
                        <div class="p-4">
                            <!-- Header row with title and buttons -->
                            <div class="flex justify-between items-center mb-4">
                                <!--  add buttons-->
                                <a href="#" class="text-blue-600 font-semibold flex items-center space-x-1" onclick="showCreateLayerModal()">
                                    <span class="text-xl">+</span>
                                    <span class="text-xl">Add</span>
                                    
                                </a>

                                <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">Layers</h2>

                                <!-- Save and Close buttons -->
                                <div class="flex items-center space-x-4">
                                    <button onclick="hideLayerPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
                                </div>
                            </div>

                       

                            <!-- Panel drag handle -->
                            <div class="flex justify-center mb-2">
                                <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
                            </div>

                            <!-- Content area (add your pLayer form here) -->

                            <div class="mb-6 dark:bg-gray-800">
                                <label class="block text-gray-700 mb-2">Background Map</label>
                                <div class="relative">
                                    <select id="layer-select" class=" w-full px-3 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8">
                                      <option value="none">None</option>
                                      <option value="apple-maps">Apple Maps</option>
                                      <option value="apple-satellite">Apple Satellite</option>
                                      <option value="apple-hybrid">Apple Hybrid</option>
                                      <option value="osm" selected>OpenStreetMap</option>
                                      <option value="watercolor">Water Color</option>
                                      <option value="google-street">Google Street</option>
                                      <option value="google-satellite">Google Satellite</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-500">
                                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                      </svg>
                                    </div>
                                  </div>
                            </div>

                            <div class="flex items-center space-x-4 mb-3">
                                <label class="flex items-center space-x-1">
                                  <input type="checkbox" class="form-checkbox">
                                  <span>Track</span>
                                </label>
                                
                                <label class="flex items-center space-x-1">
                                  <input type="checkbox" class="form-checkbox">
                                  <span>Photo</span>
                                </label>
                              </div>
                              

                            <div class="">
                                <label class="block text-gray-700 mb-2">Filter</label>
                                <div class="relative">
                                    <select class="w-full px-3 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8">
                                        <option  selected>[All Layers]</option>
                                        <option>[Feature Layers]</option>
                                        <option>[External Layers]</option>
                                        
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-500">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>


                            
                        </div>
                    </div>

                    <!--Search Panel-->

                    <div id="searchPanel" class="projects-panel dark:bg-gray-800">
                        <div class="p-4">
                            <!-- Search bar with back button -->
                            <div class="flex items-center mb-4 space-x-2">
                                <!-- Back button to sidebar -->
                                <div class="flex items-center space-x-4">
                                    <button onclick="hideSearchPanel()" class="text-gray-600 hover:text-gray-800 transition-colors duration-200">
                                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                                      </svg>
                                    </button>
                                  </div>
                                  
                                
                            </div>
                            <!-- Search bar -->
                            <div class="flex-1 relative dark:bg-gray-800">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <input type="text" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Search for items">
                            </div>
                    
                            
                    
                           
                    
                            <!-- Projects list/content would go here -->
                            <div class="projects-content">
                                <!-- Your projects list content would be here -->
                            </div>
                        </div>
                    </div>
<!-- Bluetooth GNSS Panel (hidden by default) -->
<div id="bluetoothGnssPanel" class="projects-panel dark:bg-gray-800">
    <div class="p-4">
        <!-- Header row with title and close button -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">Bluetooth GNSS Connection</h2>
            <button onclick="hideBluetoothGnssPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
        </div>

        <!-- Panel drag handle -->
        <div class="flex justify-center mb-2">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
        </div>

        <!-- Content area -->
        <div class="space-y-4">
            <div>
                <h4 class="font-medium">Status:</h4>
                <p class="text-red-500">Bluetooth OFF</p>
                <div id="blueToothStatus"></div>
            </div>
            
            <div>
                <h4 class="font-medium">Devices</h4>
                <button id="deviceList" class="text-blue-400">Scan</button>
            </div>
            
            <hr class="my-2">
            
            <div class="flex items-center justify-between">
                <h4 class="font-medium">Instrument Model</h4>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" class="form-checkbox">
                    <span class="text-sm">Log To File</span>
                </label>
            </div>
            
            <div class="relative w-full">
                <label class="font-medium">Maps GNSS</label>
                <select class="w-full px-3 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8 mt-1">
                    <option>Provac Maps GNS</option>
                    <option selected>ArduSimple BLE Bridge</option>
                    <option>SparkFun RTK</option>
                    <option>Rolavi GNSS</option>
                    <option>Generic NMEA (Bluetooth LE)</option>
                </select>
            </div>
            
            <div>
                <label class="block text-gray-700 mb-1">Instrument Height (m)</label>
                <input type="number" step="0.01" value="0.0" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>

            <div class="flex justify-center mt-6">
                <button onclick="connectBluetoothGnss()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    Connect
                </button>
            </div>
        </div>
    </div>
</div>


<!-- GNSS Status Panel (hidden by default) -->
<div id="gnssStatusPanel" class="projects-panel dark:bg-gray-800">
    <div class="p-4">
        <!-- Header row with title and close button -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">GNSS Status</h2>
            <button onclick="hideGnssStatusPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
        </div>

        <!-- Panel drag handle -->
        <div class="flex justify-center mb-2">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
        </div>

        <!-- Content area -->
        <div class="space-y-3">
            <div class="flex justify-between text-sm">
                <h4 class="font-medium">Location Source:</h4>
                <p>Internal Location Provider</p>
            </div>
            
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Date:</h4>
                    <p id="gnssDate">25 May 2025</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Time:</h4>
                    <p id="gnssTime">23:30:21 West Africa Standard Time</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">UTC Time:</h4>
                    <p id="gnssUtcTime">22:30:21</p>
                </div>
            </div>
            
            <hr class="my-2">

            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Lat:</h4>
                    <p>6.60236339° N (31N 729802.636m)</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Lon:</h4>
                    <p>3.31139102° E (31N 534421.915m)</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Ellipsoid Height:</h4>
                    <p>67.490m</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Orthometric Height (GPS):</h4>
                    <p>44.900m</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Orthometric Height (Geoid File):</h4>
                    <p>0.000m</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Fix Type:</h4>
                    <p>Single</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Speed:</h4>
                    <p>0.00km/h</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Bearing:</h4>
                    <p>24.0°</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Horizontal Accuracy:</h4>
                    <p>4.76m</p>
                </div>
                <div class="flex justify-between text-sm">
                    <h4 class="font-medium">Vertical Accuracy:</h4>
                    <p>3.35m</p>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- NTRIP Client Panel (hidden by default) -->
<div id="ntripClientPanel" class="projects-panel dark:bg-gray-800">
    <div class="p-4">
        <!-- Header with title and close button -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">NTRIP Client</h2>
            <button onclick="hideNtripClientPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
        </div>

        <!-- Panel drag handle -->
        <div class="flex justify-center mb-4">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
        </div>

        <!-- Content area matching screenshot exactly -->
        <div class="space-y-4">
            <!-- Status message (red) -->
            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-3 rounded">
                <p class="font-medium">No Credentials Found!</p>
                <p class="font-medium">Not Connected!</p>
            </div>

            <!-- PCO checkbox -->
            <div class="flex items-center">
                <input type="checkbox" id="applyPCO" class="w-4 h-4 text-blue-600 rounded">
                <label for="applyPCO" class="ml-2 text-gray-700">Apply Base Station Antenna PCO</label>
            </div>

            <!-- Connect button -->
            <button onclick="connectNtrip()" 
                    class="w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Connect
            </button>
        </div>
    </div>
</div>

<!-- Feature Layer Panel (hidden by default) -->
<div id="featureLayerPanel" class="projects-panel dark:bg-gray-800">
    <div class="p-4">
           <!-- Header row with title and close button -->
           <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">Feature</h2>
            <button onclick="hideFeatureLayerPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
        </div>

       
        <!-- Panel drag handle -->
        <div class="flex justify-center mb-4">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
        </div>

        <!-- Content area -->
        <div class="text-center">
            <p class="text-gray-700 mb-6">Feature layers were not found in this project. Would you like to create one?</p>
            
            <div class="flex justify-center space-x-4">
                <button onclick="showLayerPanelFromFeature()" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    Create Layer
                </button>
                <button onclick="hideFeatureLayerPanel()" 
                        class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Track Panel (hidden by default) -->
<div id="trackPanel" class="projects-panel dark:bg-gray-800">
    <div class="p-4">
        <!-- Header row with title and buttons -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-center" style="margin-right: 30px;">Record Track</h2>
            <button onclick="hideTrackPanel()" class="text-gray-600 text-xl font-bold">&times;</button>
        </div>

        <!-- Panel drag handle -->
        <div class="flex justify-center mb-4">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
        </div>

        <!-- Track details form -->
        <div class="space-y-4">
            <div>
                <h3 class="text-lg font-semibold mb-2">Track Name</h3>
                <input type="text" id="trackName" class="w-full px-3 py-2 border border-gray-300 rounded-md" value="Track 1">
            </div>
            
            <div>
                <h3 class="text-lg font-semibold mb-2">Description</h3>
                <textarea id="trackDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3"></textarea>
            </div>

              <!-- 🔴 Color Picker -->
              <div class="flex items-center justify-between px-2">
                <span class="text-lg font-semibold mb-2">Color</span>
                <input type="color" id="symbolColorPicker" class="w-6 h-6 border rounded cursor-pointer" value="#2563eb" />
              </div>
            
            <div class="flex items-center">
                <input type="checkbox" id="centerMapCheckbox" class="w-4 h-4 text-blue-600 rounded">
                <label for="centerMapCheckbox" class="ml-2 text-gray-700">Center Map on Current Location</label>
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="saveTrack()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save</button>
                <button onclick="hideTrackPanel()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">Cancel</button>
            </div>
        </div>
    </div>
</div>
                    
  
        
        <!-- Overlay for projects panel -->
        <div id="projectsOverlay" class="projects-overlay"></div>

        <main class="mt-16 flex-1 overflow-y-auto bg-white">
            <div class="container-mobile flex-1 w-full h-full ">  <!-- Added h-full here -->
              <!-- Map Here -->
              <div id="map" class="w-full h-full z-0 dark:bg-gray-800" ></div>  <!-- Changed height calculation -->
            </div>


          <!-- Map Icons -->
<div class="fixed top-16 left-0 right-0 z-10 flex justify-center space-x-4 p-4">
    <!-- Horizontal Icons (4) -->
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-sync-alt text-blue-600"></i>
    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-satellite-dish text-blue-600"></i>
    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-cloud-upload-alt text-blue-600"></i>

    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-chart-area text-blue-600"></i> 
    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-signal text-blue-600"></i>
    </button>
</div>

<div class="fixed top-32 left-2 z-10 flex flex-col space-y-2">


    <!-- Vertical Icons (5) -->
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-search text-blue-600"></i>
     </button>
     <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-location-arrow text-blue-600"></i>
    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-ruler text-blue-600"></i>
    </button>
    <button class="map-icon bg-white rounded-full dark:bg-gray-700 shadow-md hover:bg-blue-100 p-1 w-8 h-8 flex items-center justify-center">
        <i class="fas fa-draw-polygon text-blue-600"></i>
    </button>
    
</div>

  
    
        </main>
          
            
                
                        

               
           
    </div>

    <!-- Create Project Modal -->
<div id="createProjectModal" class="fixed dark:bg-gray-800  inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
        <h3 class="text-xl font-semibold mb-4">Create Project</h3>
        <p class="text-gray-600 mb-4">Create a project to save layers, points and photos.</p>
        
        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Project Name</label>
            <input type="text" id="projectName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-6">
            <label class="block text-gray-700 mb-2">Import Layers</label>
            <div class="relative">
                <select class="w-full px-3 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8">
                    <option selected>Do not import</option>
                    <option>Project</option>
                    <option>Template</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="flex justify-end space-x-3">
            <button onclick="hideCreateProjectModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">Cancel</button>
            <button onclick="createProject()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Create</button>
        </div>
    </div>
</div>

<!-- Create Project attribute Modal -->
<div id="createProjectAttributeModal" class="fixed dark:bg-gray-800 inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
        <h3 class="text-xl font-semibold mb-4">Add Project Attribute</h3>
        
        
        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Attribute Name</label>
            <input type="text" id="projectName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-6">
            <label class="block text-gray-700 mb-2">Attribute Type</label>
            <div class="relative">
                <select class="w-full px-3 py-2 bg-gray-100 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8">
                    <option>Options</option>
                    <option>Numeric</option>
                    <option selected>Text</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-500">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="flex justify-end space-x-3">
            <button onclick="hideCreateProjectAttributeModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">Cancel</button>
            <button onclick="createProjectAttribute()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Add</button>
        </div>
    </div>
</div>


  <!-- Main Button to Open Modal -->
 

  <!-- Create Layer Modal - Main Selection -->
  <div id="createLayerModal" class="fixed dark:bg-gray-800 inset-0 z-50 hidden">
    <!-- overlay -->
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>

    <!-- content -->
    <div id="layerTypeBox" class="relative dark:bg-gray-800 mx-auto mt-24 w-64 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Select Layer Type</h3>
      <ul class="space-y-3 select-none">
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="mbtilesLayerModal">MBTiles</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="shapefileLayerModal">Shapefile</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="gpkgLayerModal">GeoPackage (GPKG)</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="geojsonLayerModal">GeoJSON</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="kmlLayerModal">KML</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="onlineTilesModal">Online Tiles (TMS/WMTS/XYZ)</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="wmsLayerModal">WMS</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="numericLayerModal">GNSS Recorded Feature</li>
        <li class="layer-item cursor-pointer hover:bg-blue-100 px-4 py-2 rounded" data-modal="textLayerModal">Drawn Feature</li>
      </ul>
    </div>
  </div>

  <!-- Individual Layer Type Modals -->
  
  <!-- MBTiles Modal -->
  <div id="mbtilesLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add MbTiles Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
         <p>No files were found. Please copy the layers to Provac Maps folder in your device.</p>
        </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('mbtiles')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- Shapefile Modal -->
  <div id="shapefileLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add Shapefile Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
           <p>No files were found. Please copy the layers to Provac Maps folder in your device.</p>
          </div>
        
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('shapefile')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- GeoPackage Modal -->
  <div id="gpkgLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add GeoPackage Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
           <p>No files were found. Please copy the layers to Provac Maps folder in your device.</p>
          </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('gpkg')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- GeoJSON Modal -->
  <div id="geojsonLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add GeoJSON Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
           <p>No files were found. Please copy the layers to Provac Maps folder in your device.</p>
          </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('geojson')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- KML Modal -->
  <div id="kmlLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add KML Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
           <p>No files were found. Please copy the layers to Provac Maps folder in your device.</p>
          </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('kml')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add Layer</button>
      </div>
    </div>
  </div>

  <!-- Online Tiles Modal -->
  <div id="onlineTilesModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add Online Tile Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tile Source URL</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
          <div class="text-[12px] inline-flex space-x-1">
            <span class="text-gray-400">Example:</span>
            <span class="text-blue-400">https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</span>
          </div>
        </div>
        <!--<div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
          <select class="w-full px-3 py-2 border rounded">
            <option value="xyz">XYZ</option>
            <option value="tms">TMS</option>
            <option value="wmts">WMTS</option>
          </select>
        </div>-->
        <div class="flex items-center">
          <input type="checkbox" id="tileAuth" class="mr-2">
          <label for="tileAuth" class="text-sm font-medium text-gray-700">Cache Tiles</label>
        </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('onlineTiles')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- WMS Modal -->
  <div id="wmsLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">Add WMS Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">WMS URL</label>
          <input type="text" placeholder="https://example.com/wms" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                <span>WMS Layer Name</span>
                    <button class="text-blue-400 hover:underline focus:outline-none" onclick="selectWmsLayer()">
                      Select Layer
                    </button>
                  </label>
                  
              </label>
              
          <input type="text" placeholder="layer1,layer2" class="w-full px-3 py-2 border rounded">
        </div>
        <div class="flex items-center">
            <input type="checkbox" id="tileAuth" class="mr-2">
            <label for="tileAuth" class="text-sm font-medium text-gray-700">Cache Tiles</label>
          </div>
      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('wms')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <!-- GNSS Recorded Feature Modal (hidden by default) -->
<div id="numericLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold mb-4">Add GNSS Recorded Feature</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
                <input type="text" class="w-full px-3 py-2 border rounded">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Feature Type</label>
                <select class="w-full px-3 py-2 border rounded">
                    <option value="point">Point</option>
                    <option value="line">Line</option>
                    <option value="polygon">Polygon</option>
                </select>
            </div>
            <div class="relative w-full max-w-sm">
                <!-- Label and Current Symbol -->
                <label class="flex items-center justify-between text-sm font-medium text-gray-700 mb-1 select-none">
                    <span>Geometry Symbol</span>
                    <button id="gnss-currentSymbolBtn" class="w-6 h-6 text-blue-600" onclick="toggleGnssSymbolMenu(event)">
                        <!-- Default: Circle Outline -->
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>
                    </button>
                </label>
            
                <!-- Symbol Menu -->
                <div id="gnss-symbolMenu" class="absolute right-0 mt-1 w-56 bg-white border rounded shadow-lg p-2 space-y-2 hidden z-50">
                    <!-- Color Picker -->
                    <div class="flex items-center justify-between px-2">
                        <span class="text-sm font-medium text-gray-600">Point Color</span>
                        <input type="color" id="gnss-symbolColorPicker" class="w-6 h-6 border rounded cursor-pointer" value="#2563eb" />
                    </div>
                    <hr class="my-1">
                
                    <!-- Symbol Items -->
                    <div class="space-y-2">
                        <p class="text-sm font-medium text-gray-600">Point Shape</p>
                        
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="filled-triangle" title="Filled Triangle">
                            <svg viewBox="0 0 24 24" fill="#2563eb" class="w-4 h-4"><polygon points="12 4 20 20 4 20"/></svg>
                            <span>Filled Triangle</span>
                        </button>
                
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="triangle" title="Triangle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="w-4 h-4">
                                <polygon points="12 4 20 20 4 20"/>
                            </svg>
                            <span>Triangle</span>
                        </button>
                
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="filled-square" title="Filled Square">
                            <svg viewBox="0 0 24 24" fill="#2563eb" class="w-4 h-4">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                            </svg>
                            <span>Filled Square</span>
                        </button>
                    
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="square" title="Square">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="w-4 h-4">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                            </svg>
                            <span>Square</span>
                        </button>
                    
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="plus" title="Plus">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="w-4 h-4">
                                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>Plus</span>
                        </button>
                    
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="cross" title="Cross">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="w-4 h-4">
                                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            <span>Cross</span>
                        </button>
                    
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="filled-circle" title="Filled Circle">
                            <svg viewBox="0 0 24 24" fill="#2563eb" class="w-4 h-4">
                                <circle cx="12" cy="12" r="9"/>
                            </svg>
                            <span>Filled Circle</span>
                        </button>
                    
                        <button class="gnss-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600 p-1 rounded"
                                data-symbol="circle" title="Circle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="w-4 h-4">
                                <circle cx="12" cy="12" r="9"/>
                            </svg>
                            <span>Circle</span>
                        </button>
                    </div>
                
                    <!-- OK / Cancel -->
                    <div class="flex justify-end space-x-4 pt-2 border-t mt-2 text-sm text-blue-600">
                        <button onclick="closeGnssMenu()" class="hover:underline">Cancel</button>
                        <button onclick="closeGnssMenu()" class="font-semibold hover:underline">OK</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex justify-end space-x-2 mt-6">
            <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
            <button onclick="saveLayer('gnss')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
        </div>
    </div>
</div>

<script>
    // GNSS Symbol Picker Functions
    let gnssSelectedColor = "#2563eb";
    
    function toggleGnssSymbolMenu(e) {
        e.stopPropagation();
        const menu = document.getElementById('gnss-symbolMenu');
        menu.classList.toggle('hidden');
        
        if (!menu.classList.contains('hidden')) {
            document.addEventListener('click', gnssOutsideClose);
            document.addEventListener('keydown', gnssEscClose);
        } else {
            document.removeEventListener('click', gnssOutsideClose);
            document.removeEventListener('keydown', gnssEscClose);
        }
    }
    
    function closeGnssMenu() {
        document.getElementById('gnss-symbolMenu').classList.add('hidden');
        document.removeEventListener('click', gnssOutsideClose);
        document.removeEventListener('keydown', gnssEscClose);
    }
    
    function gnssOutsideClose(e) {
        if (!document.getElementById('gnss-symbolMenu').contains(e.target) &&
            e.target.id !== 'gnss-currentSymbolBtn') {
            closeGnssMenu();
        }
    }
    
    function gnssEscClose(e) {
        if (e.key === 'Escape') closeGnssMenu();
    }
    
    // Initialize GNSS color picker
    document.addEventListener('DOMContentLoaded', function() {
        const gnssColorPicker = document.getElementById('gnss-symbolColorPicker');
        
        // Update color on input
        gnssColorPicker.addEventListener('input', function() {
            gnssSelectedColor = this.value;
            
            // Update all GNSS symbol previews
            document.querySelectorAll('.gnss-symbol-btn svg').forEach(svg => {
                if (svg.getAttribute('fill') && svg.getAttribute('fill') !== "none") {
                    svg.setAttribute('fill', gnssSelectedColor);
                }
                if (svg.getAttribute('stroke') && svg.getAttribute('stroke') !== "none") {
                    svg.setAttribute('stroke', gnssSelectedColor);
                }
            });
            
            // Update current symbol
            const currentBtn = document.getElementById('gnss-currentSymbolBtn');
            const currentSvg = currentBtn.querySelector('svg');
            if (currentSvg) {
                if (currentSvg.getAttribute('fill') && currentSvg.getAttribute('fill') !== "none") {
                    currentSvg.setAttribute('fill', gnssSelectedColor);
                }
                if (currentSvg.getAttribute('stroke') && currentSvg.getAttribute('stroke') !== "none") {
                    currentSvg.setAttribute('stroke', gnssSelectedColor);
                }
            }
        });
        
        // Trigger initial color update
        gnssColorPicker.dispatchEvent(new Event('input'));
        
        // Handle symbol selection
        document.querySelectorAll('.gnss-symbol-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const svg = this.querySelector('svg').cloneNode(true);
                
                // Apply current color
                if (svg.getAttribute('fill') && svg.getAttribute('fill') !== "none") {
                    svg.setAttribute('fill', gnssSelectedColor);
                }
                if (svg.getAttribute('stroke') && svg.getAttribute('stroke') !== "none") {
                    svg.setAttribute('stroke', gnssSelectedColor);
                }
                
                // Update preview button
                const preview = document.getElementById('gnss-currentSymbolBtn');
                preview.innerHTML = '';
                preview.appendChild(svg);
                
                closeGnssMenu();
            });
        });
    });
</script>

  <!-- Drawn Feature Modal -->
  <div id="textLayerModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div>
    <div class="relative dark:bg-gray-800 mx-auto mt-24 w-96 bg-white p-6 rounded-lg shadow-lg" onclick="event.stopPropagation()">
      <h3 class="text-lg font-bold mb-4">New Drawn Feature Layer</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Layer Name</label>
          <input type="text" class="w-full px-3 py-2 border rounded">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Goemetry Type</label>
          <select class="w-full px-3 py-2 border rounded">
            <option value="point">Point</option>
            <option value="line">Line</option>
            <option value="polygon">Polygon</option>
            <option value="text">Text Label</option>
          </select>
        </div>
        <div class="relative w-full max-w-sm">
            <!-- Label and Current Symbol -->
            <label class="flex items-center justify-between text-sm font-medium text-gray-700 mb-1 select-none">
                <span>Geometry Symbol</span>
                <button id="geometrySymbolBtn" class="w-6 h-6 text-blue-600" onclick="toggleGeometrySymbolMenu(event)">
                    <!-- Default: Circle Outline -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9"/></svg>
                </button>
            </label>
          
            <!-- Symbol Menu -->
            <div id="geometrySymbolMenu"
                 class="absolute right-0 mt-1 w-56 bg-white border rounded shadow-lg p-2 space-y-2 hidden z-50">
          
                <!-- Color Picker -->
                <div class="flex items-center justify-between px-2">
                    <span class="text-sm font-medium text-gray-600">Point Color</span>
                    <input type="color" id="geometrySymbolColorPicker" class="w-6 h-6 border rounded cursor-pointer" value="#2563eb" />
                </div>
                <hr class="my-1">
          
                <!-- Symbol Items -->
                <div id="geometrySymbolList" class="space-y-2">
                    <p class="text-sm font-medium text-gray-600">Point Shape</p>
                    
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="filled-triangle" title="Filled Triangle">
                        <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><polygon points="12 4 20 20 4 20"/></svg>
                        <span>Filled Triangle</span>
                    </button>
          
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="triangle" title="Triangle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                            <polygon points="12 4 20 20 4 20"/>
                        </svg>
                        <span>Triangle</span>
                    </button>
          
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="filled-square" title="Filled Square">
                        <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                            <rect x="4" y="4" width="16" height="16" rx="2"/>
                        </svg>
                        <span>Filled Square</span>
                    </button>
            
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="square" title="Square">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                            <rect x="4" y="4" width="16" height="16" rx="2"/>
                        </svg>
                        <span>Square</span>
                    </button>
            
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="plus" title="Plus">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span>Plus</span>
                    </button>
            
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="cross" title="Cross">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                        <span>Cross</span>
                    </button>
            
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="filled-circle" title="Filled Circle">
                        <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                            <circle cx="12" cy="12" r="9"/>
                        </svg>
                        <span>Filled Circle</span>
                    </button>
            
                    <button class="geometry-symbol-btn flex items-center space-x-2 w-full text-gray-700 hover:text-blue-600"
                            data-symbol="circle" title="Circle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                            <circle cx="12" cy="12" r="9"/>
                        </svg>
                        <span>Circle</span>
                    </button>
                </div>
          
                <!-- OK / Cancel -->
                <div class="flex justify-end space-x-4 pt-2 border-t mt-2 text-sm text-blue-600">
                    <button onclick="closeGeometrySymbolMenu()" class="hover:underline">Cancel</button>
                    <button onclick="closeGeometrySymbolMenu()" class="font-semibold hover:underline">OK</button>
                </div>
            </div>
        </div>
          
        <script>
        // Use a self-invoking function to avoid global scope pollution
        (function() {
            let geometrySymbolColor = "#2563eb"; // default blue
        
            function toggleGeometrySymbolMenu(e) {
                e.stopPropagation();
                const menu = document.getElementById('geometrySymbolMenu');
                menu.classList.toggle('hidden');
                
                if (!menu.classList.contains('hidden')) {
                    document.addEventListener('click', outsideGeometrySymbolClose);
                    document.addEventListener('keydown', escGeometrySymbolClose);
                } else {
                    document.removeEventListener('click', outsideGeometrySymbolClose);
                    document.removeEventListener('keydown', escGeometrySymbolClose);
                }
            }
        
            function closeGeometrySymbolMenu() {
                document.getElementById('geometrySymbolMenu').classList.add('hidden');
                document.removeEventListener('click', outsideGeometrySymbolClose);
                document.removeEventListener('keydown', escGeometrySymbolClose);
            }
        
            function outsideGeometrySymbolClose(e) {
                if (!document.getElementById('geometrySymbolMenu').contains(e.target) &&
                    e.target.id !== 'geometrySymbolBtn') {
                    closeGeometrySymbolMenu();
                }
            }
        
            function escGeometrySymbolClose(e) {
                if (e.key === 'Escape') closeGeometrySymbolMenu();
            }
        
            // Update color on input
            document.getElementById('geometrySymbolColorPicker').addEventListener('input', function() {
                geometrySymbolColor = this.value;
                // Update all preview symbols
                document.querySelectorAll('.geometry-symbol-btn svg').forEach(svg => {
                    if (svg.getAttribute('fill') !== "none") {
                        svg.setAttribute('fill', geometrySymbolColor);
                    }
                    if (svg.getAttribute('stroke') !== null) {
                        svg.setAttribute('stroke', geometrySymbolColor);
                    }
                });
            });
        
            // On symbol click
            document.querySelectorAll('.geometry-symbol-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const svg = e.currentTarget.querySelector('svg').cloneNode(true);
                
                    // Apply selected color
                    if (svg.getAttribute('fill') !== "none") {
                        svg.setAttribute('fill', geometrySymbolColor);
                    }
                    if (svg.getAttribute('stroke') !== null) {
                        svg.setAttribute('stroke', geometrySymbolColor);
                    }
                
                    // Update main button
                    const preview = document.getElementById('geometrySymbolBtn');
                    preview.innerHTML = '';
                    preview.appendChild(svg);
                
                    closeGeometrySymbolMenu();
                });
            });
        
            // Initialize
            window.toggleGeometrySymbolMenu = toggleGeometrySymbolMenu;
            window.closeGeometrySymbolMenu = closeGeometrySymbolMenu;
        })();
        </script>


      </div>
      <div class="flex justify-end space-x-2 mt-6">
        <button onclick="closeAll()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="saveLayer('drawn')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
      </div>
    </div>
  </div>

  <script>
    /* Utility */
    const $ = id => document.getElementById(id);
    
    /* Open first modal */
    function openLayerType() {
      $('createLayerModal').classList.remove('hidden');
      document.addEventListener('keydown', handleEsc);
    }
    
    /* Close every modal */
    function closeAll() {
      document.querySelectorAll('[id$="LayerModal"], [id$="Modal"]').forEach(modal => {
        modal.classList.add('hidden');
      });
      document.removeEventListener('keydown', handleEsc);
    }
    
    /* Handle Esc key */
    function handleEsc(e) {
      if (e.key === 'Escape') closeAll();
    }
    
    /* Make the list items clickable */
    document.querySelectorAll('.layer-item').forEach(li => {
      li.onclick = () => {
        const modalId = li.getAttribute('data-modal');
        $('createLayerModal').classList.add('hidden');
        $(modalId).classList.remove('hidden');
      };
    });
    
    /* Save layer function - customize for each layer type */
    function saveLayer(layerType) {
      console.log('Saving layer of type:', layerType);
      // Here you would collect the form data and process it
      // For example:
      // const layerName = document.querySelector(`#${layerType}LayerModal input[type="text"]`).value;
      // const fileInput = document.querySelector(`#${layerType}LayerModal input[type="file"]`);
      // const file = fileInput ? fileInput.files[0] : null;
      
      // Then send to your backend or process as needed
      alert(`Layer of type ${layerType} would be saved here`);
      
      closeAll();
    }
  </script>





  
  
  <script>
     
    // Toggle sidebar visibility (overlay version)
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const filterInput = document.querySelector('input[name="filter"]'); // Add this line

    sidebarToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        // Only allow toggling if no panels are open, or if we're opening the sidebar
        if (!isAnyPanelOpen() || sidebar.classList.contains('sidebar-hidden')) {
            sidebar.classList.toggle('sidebar-hidden');
            sidebarOverlay.classList.toggle('hidden');
            document.body.classList.toggle('sidebar-open');
        }
    });

    // Function to check if any panel is open
    function isAnyPanelOpen() {
        const panels = [
            'projectsPanel',
            'projectAttributesPanel',
            'layerPanel',
            'searchPanel',
            'bluetoothGnssPanel',
            'gnssStatusPanel',
            'ntripClientPanel',
            'featureLayerPanel',
            'trackPanel'
        ];
        
        const modals = [
            'createProjectModal',
            'createProjectAttributeModal', 
            'createLayerModal'
        ];
        
        // Check if any panel is visible
        const isPanelOpen = panels.some(panelId => {
            const panel = document.getElementById(panelId);
            return panel && panel.classList.contains('projects-panel-visible');
        });
        
        // Check if any modal is open
        const isModalOpen = modals.some(modalId => {
            const modal = document.getElementById(modalId);
            return modal && !modal.classList.contains('hidden');
        });
        
        return isPanelOpen || isModalOpen;
    }

    // Close sidebar when clicking anywhere on the document
    document.addEventListener('click', (e) => {
        // Check if sidebar is currently visible
        const isSidebarVisible = !sidebar.classList.contains('sidebar-hidden');
        
        // Check if click is outside the sidebar (and not on the toggle button or filter input)
        const isClickOutside = !sidebar.contains(e.target) && 
                              e.target !== sidebarToggle &&
                              e.target !== filterInput;
        
        // Only close sidebar if no panels are open
        if (isSidebarVisible && isClickOutside && !isAnyPanelOpen()) {
            sidebar.classList.add('sidebar-hidden');
            sidebarOverlay.classList.add('hidden');
            document.body.classList.remove('sidebar-open');
        }
    });
        
        // Close sidebar when clicking overlay
        sidebarOverlay.addEventListener('click', () => {
            // Only close sidebar if no modals are open
            if (!isAnyModalOpen()) {
                sidebar.classList.add('sidebar-hidden');
                sidebarOverlay.classList.add('hidden');
                document.body.classList.remove('sidebar-open');
            }
        });
        
        // Hamburger menu dropdown functionality
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const hamburgerDropdown = document.getElementById('hamburgerDropdown');
        
        hamburgerMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            hamburgerDropdown.style.display = hamburgerDropdown.style.display === 'block' ? 'none' : 'block';
            // Close the line plotting dropdown if open
            linePlottingDropdown.style.display = 'none';
        });
        
        // Line plotting menu dropdown functionality
        const linePlottingMenu = document.getElementById('linePlottingMenu');
        const linePlottingDropdown = document.getElementById('linePlottingDropdown');
        
        linePlottingMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            linePlottingDropdown.style.display = linePlottingDropdown.style.display === 'block' ? 'none' : 'block';
            // Close the hamburger dropdown if open
            hamburgerDropdown.style.display = 'none';
        });
        
        // Close dropdowns when clicking anywhere else
        document.addEventListener('click', (e) => {
            if (!hamburgerDropdown.contains(e.target) && e.target !== hamburgerMenu) {
                hamburgerDropdown.style.display = 'none';
            }
            if (!linePlottingDropdown.contains(e.target) && e.target !== linePlottingMenu) {
                linePlottingDropdown.style.display = 'none';
            }
        });
        
        // Projects panel functionality
        const projectsPanel = document.getElementById('projectsPanel');
        const projectsOverlay = document.getElementById('projectsOverlay');
        
        function showProjectsPanel() {
            projectsPanel.classList.add('projects-panel-visible');
            projectsOverlay.style.display = 'block';
            document.body.classList.add('sidebar-open'); 
            


            // Close sidebar if open
            //if (!sidebar.classList.contains('sidebar-hidden')) {
            //    sidebar.classList.add('sidebar-hidden');
           //     sidebarOverlay.classList.add('hidden');
          //  }
            
            // Close dropdown menus
            hamburgerDropdown.style.display = 'none';
            linePlottingDropdown.style.display = 'none';
        }

        // Projects Attribute panel functionality
        const projectAttributesPanel = document.getElementById('projectAttributesPanel');
        const projectsAttributeOverlay = document.getElementById('projectsAttributeOverlay');
        
        function showprojectAttributesPanel() {
            projectAttributesPanel.classList.add('projects-panel-visible');
            projectsAttributeOverlay.style.display = 'block';
            document.body.classList.add('sidebar-open'); 
            


            
            // Close dropdown menus
            hamburgerDropdown.style.display = 'none';
            linePlottingDropdown.style.display = 'none';
        }

             // Layer panel functionality
             const layerPanel = document.getElementById('layerPanel');
             const layerOverlay = document.getElementById('layerOverlay');
             
             function showLayerPanel() {
                layerPanel.classList.add('projects-panel-visible');
                layerOverlay.style.display = 'block';
                 document.body.classList.add('sidebar-open'); 
                 
     
     
                 
                 // Close dropdown menus
                 hamburgerDropdown.style.display = 'none';
                 linePlottingDropdown.style.display = 'none';
             }



        // Search panel functionality
        const searchPanel = document.getElementById('searchPanel');
        const searchOverlay = document.getElementById('searchOverlay');
        
        function showSearchPanel() {
           layerPanel.classList.add('projects-panel-visible');
           layerOverlay.style.display = 'block';
            document.body.classList.add('sidebar-open'); 
            


            
            // Close dropdown menus
            hamburgerDropdown.style.display = 'none';
            linePlottingDropdown.style.display = 'none';
        }


        
        
        function hideProjectsPanel() {
            projectsPanel.classList.remove('projects-panel-visible');
            projectsOverlay.style.display = 'none';
            document.body.classList.remove('sidebar-open');
        }
        
        // Close projects panel when clicking overlay
        projectsOverlay.addEventListener('click', hideProjectsPanel);
        
        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.getElementById('mapPage').classList.add('hidden');
            document.getElementById('projectsPage').classList.add('hidden');
            
            // Show selected page
            document.getElementById(pageId).classList.remove('hidden');
            
            // Close projects panel if open
            if (projectsPanel.classList.contains('projects-panel-visible')) {
                hideProjectsPanel();
            }
            
            // Close dropdown menus
            hamburgerDropdown.style.display = 'none';
            linePlottingDropdown.style.display = 'none';
        }
        
        // Show projects page
        function showProjects() {
            showPage('projectsPage');
        }
        
        // Take photo function
        function takePhoto() {
            alert('Photo functionality would be implemented here');
            // In a real app, this would access the device camera
        }
        
        // Record feature function
        function recordFeature() {
            alert('Record Feature functionality would be implemented here');
            // In a real app, this would start recording a feature
        }
        
        // Record track function
        function recordTrack() {
            alert('Record Track functionality would be implemented here');
            // In a real app, this would start recording a track
        }
        
        // Show map page by default
        showPage('map');

        // Show Create Project Modal
function showCreateProjectModal() {
    document.getElementById('createProjectModal').classList.remove('hidden');
    document.body.classList.add('modal-open');
}

// Hide Create Project Modal
function hideCreateProjectModal() {
    document.getElementById('createProjectModal').classList.add('hidden');
    document.body.classList.remove('modal-open');
}

        // Show Create Project Attribute Modal
        function showCreateProjectAttributeModal() {
            document.getElementById('createProjectAttributeModal').classList.remove('hidden');
            document.body.classList.add('modal-open');
        }
        
        // Hide Create Project Attribute Modal
        function hideCreateProjectAttributeModal() {
            document.getElementById('createProjectAttributeModal').classList.add('hidden');
            document.body.classList.remove('modal-open');
        }

          // Show Create Layer Modal
          function showCreateLayerModal() {
            document.getElementById('createLayerModal').classList.remove('hidden');
            document.body.classList.add('modal-open');
        }
        
        // Hide Create Layer Modal
        function hideCreateLayerModal() {
            document.getElementById('createLayerModal').classList.add('hidden');
            document.body.classList.remove('modal-open');
        }




// Create Project Function
function createProject() {
    const projectName = document.getElementById('projectName').value;
    if (!projectName) {
        alert('Please enter a project name');
        return;
    }
    
    // Here you would typically make an API call to create the project
    alert(`Project "${projectName}" created successfully!`);
    hideCreateProjectModal();
    
    // Refresh projects list or do other post-creation actions
}

// add Project Attribute Function
function createProjectAttribute() {
    const projectName = document.getElementById('projectName').value;
    if (!projectName) {
        alert('Please add a project name');
        return;
    }
    
    // Here you would typically make an API call to create the project
    alert(`Project "${projectName}" created successfully!`);
    hideCreateProjectAttributeModal();
    
    // Refresh projects list or do other post-creation actions
}

// Show Project Attributes Panel
function showProjectAttributesPanel() {
    document.getElementById('projectAttributesPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
}

// Hide Project Attributes Panel
function hideProjectAttributesPanel() {
    document.getElementById('projectAttributesPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Save Project Attributes
function saveProjectAttributes() {
    // Add your save logic here
    alert('Project attributes saved!');
    hideProjectAttributesPanel();
}

// Layer Function
function createLayer() {
    const projectName = document.getElementById('projectName').value;
    if (!projectName) {
        alert('Please add a Layer');
        return;
    }
    
    // Here you would typically make an API call to create the project
    alert(`Layer "${projectName}" created successfully!`);
    hideCreateLayerModal();
    
    // Refresh projects list or do other post-creation actions
}

// Show Layer Panel
function showLayerPanel() {
    document.getElementById('layerPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
}

// Hide Layer Panel
function hideLayerPanel() {
    document.getElementById('layerPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}


// Search Function
function createLayer() {
    const projectName = document.getElementById('projectName').value;
    if (!projectName) {
        alert('Please add a Layer');
        return;
    }
    
 
    
    // Refresh projects list or do other post-creation actions
}

// Show search Panel
function showSearchPanel() {
    document.getElementById('searchPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
}

// Hide search Panel
function hideSearchPanel() {
    document.getElementById('searchPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}


// Show Bluetooth GNSS Panel
function showBluetoothGnssPanel() {
    document.getElementById('bluetoothGnssPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
    
    // Close dropdown menus
    hamburgerDropdown.style.display = 'none';
    linePlottingDropdown.style.display = 'none';
}

// Hide Bluetooth GNSS Panel
function hideBluetoothGnssPanel() {
    document.getElementById('bluetoothGnssPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Connect Bluetooth GNSS function
function connectBluetoothGnss() {
    // Implementation for connecting to Bluetooth GNSS would go here
    alert('Bluetooth GNSS connection functionality would be implemented here');
    
    // Update status (example)
    const statusElement = document.getElementById('blueToothStatus');
    statusElement.innerHTML = '<p class="text-green-500">Connecting...</p>';
    
    // In a real app, you would have proper connection state handling
    setTimeout(() => {
        statusElement.innerHTML = '<p class="text-green-500">Connected to device</p>';
    }, 1500);
}


// Show GNSS Status Panel
function showGnssStatusPanel() {
    document.getElementById('gnssStatusPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
    
    // Update with current time
    updateGnssStatus();
    
    // Close dropdown menus
    hamburgerDropdown.style.display = 'none';
    linePlottingDropdown.style.display = 'none';
}

// Hide GNSS Status Panel
function hideGnssStatusPanel() {
    document.getElementById('gnssStatusPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Update GNSS Status with current data
function updateGnssStatus() {
    const now = new Date();
    const options = { 
        day: 'numeric', 
        month: 'long', 
        year: 'numeric' 
    };
    
    // Format the current date and time
    document.getElementById('gnssDate').textContent = now.toLocaleDateString('en-US', options);
    document.getElementById('gnssTime').textContent = now.toLocaleTimeString('en-US', { 
        timeZone: 'Africa/Lagos',
        timeZoneName: 'long' 
    });
    document.getElementById('gnssUtcTime').textContent = now.toUTCString().split(' ')[4];
    
    // In a real app, you would update other fields with actual GNSS data here
}

// Show NTRIP Client Panel
function showNtripClientPanel() {
    document.getElementById('ntripClientPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
    
    // Close dropdown menus
    hamburgerDropdown.style.display = 'none';
    linePlottingDropdown.style.display = 'none';
}

// Hide NTRIP Client Panel
function hideNtripClientPanel() {
    document.getElementById('ntripClientPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Connect NTRIP function
function connectNtrip() {
    // Implementation would go here
    alert('NTRIP connection functionality would be implemented here');
    
    // Example status update (would be dynamic in real app)
    const statusDiv = document.querySelector('#ntripClientPanel .bg-red-100');
    statusDiv.classList.remove('bg-red-100', 'border-red-500', 'text-red-700');
    statusDiv.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
    statusDiv.innerHTML = `
        <p class="font-medium">Connected to: NTRIP Caster</p>
        <p class="font-medium">RTCM3 Stream Active</p>
    `;
}

// Show Feature Layer Panel
function showFeatureLayerPanel() {
    document.getElementById('featureLayerPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
}

// Hide Feature Layer Panel
function hideFeatureLayerPanel() {
    document.getElementById('featureLayerPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Special function to transition to Layer Panel
function showLayerPanelFromFeature() {
    hideFeatureLayerPanel();
    setTimeout(() => {
        showLayerPanel();
    }, 300); // Small delay for smooth transition
}

// Show Track Panel
function showTrackPanel() {
    document.getElementById('trackPanel').classList.add('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'block';
    document.body.classList.add('sidebar-open');
    
    // Close dropdown menus
    hamburgerDropdown.style.display = 'none';
    linePlottingDropdown.style.display = 'none';
}

// Hide Track Panel
function hideTrackPanel() {
    document.getElementById('trackPanel').classList.remove('projects-panel-visible');
    document.getElementById('projectsOverlay').style.display = 'none';
    document.body.classList.remove('sidebar-open');
}

// Save Track function
function saveTrack() {
    const trackName = document.getElementById('trackName').value;
    const description = document.getElementById('trackDescription').value;
    const centerMap = document.getElementById('centerMapCheckbox').checked;
    
    // Here you would typically save the track data
    console.log('Track saved:', { trackName, description, centerMap });
    
    hideTrackPanel();
}



  



       
        
        
    </script>

    <!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>


  <script>
    window.addEventListener('load', function () {
      // Initialize the map
      var map = L.map('map', {
        center: [54.5260, 15.2551],
        zoom: 4,
        zoomControl: false // disable default zoom control to place custom
      });
  
      // Tile layers
      var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
      });
  
      var watercolor = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.{ext}', {
        maxZoom: 16,
        attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      });
  
      // Google Maps layers using Google tile URLs
      // Note: Using Google's tiles directly without API key can be against TOS; this is for demo only
      var googleStreet = L.tileLayer('http://mt0.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        attribution: '© Google'
      });
  
      var googleSatellite = L.tileLayer('http://mt0.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        attribution: '© Google'
      });
  
      // You can add Apple Maps layers similarly if you find tile URLs (usually proprietary, so skipped here)
  
      // Start with OSM
      osm.addTo(map);
  
      // Add zoom control at bottom right
      L.control.zoom({ position: 'bottomright' }).addTo(map);
  
      // Layer switch logic
      var currentLayer = osm;
  
      document.getElementById('layer-select').addEventListener('change', function () {
        var selected = this.value;
  
        // Remove current layer
        if (currentLayer) {
          map.removeLayer(currentLayer);
        }
  
        // Add new layer based on selection
        switch (selected) {
          case 'osm':
            currentLayer = osm;
            break;
          case 'watercolor':
            currentLayer = watercolor;
            break;
          case 'google-street':
            currentLayer = googleStreet;
            break;
          case 'google-satellite':
            currentLayer = googleSatellite;
            break;
          // You can add cases for Apple Maps if tile URLs available
          default:
            currentLayer = null; // no base layer
            break;
        }
  
        if (currentLayer) {
          currentLayer.addTo(map);
        }
      });
    });




   // Handle map icon clicks
document.querySelectorAll('.map-icon').forEach(icon => {
    icon.addEventListener('click', function() {
        const iconClass = this.querySelector('i').className;
        
        if (iconClass.includes('fa-sync-alt')) {
            location.reload(); //  Reloads the current page
        } else if (iconClass.includes('fa-location-arrow')) {
            alert('Location arrow clicked - center on current location');
            // Add geolocation code here
        } else if (iconClass.includes('fa-cloud-upload-alt')) {
            showNtripClientPanel();
        } else if (iconClass.includes('fa-search')) {
            showSearchPanel();
        } else if (iconClass.includes('fa-satellite-dish')) {
            showBluetoothGnssPanel();
        } else if (iconClass.includes('fa-ruler')) {
            alert('Measurement tool');
        } else if (iconClass.includes('fa-draw-polygon')) {
            alert('Drawing tool');
        } else if (iconClass.includes('fa-info-circle')) {
            alert('Map information');
        } else if (iconClass.includes('fa-cog')) {
            alert('Map settings');
        } else if (iconClass.includes('fa-chart-area')) {
            alert('Map settings');
        } else if (iconClass.includes('fa-signal')) {
             showGnssStatusPanel();
        }
    });
});


// Dark Mode Toggle
const darkModeToggle = document.getElementById('darkModeToggle');
const darkModeIcon = document.getElementById('darkModeIcon');

// Check for saved preference or system preference
const userPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
const currentTheme = localStorage.getItem('theme') || (userPrefersDark ? 'dark' : 'light');

// Apply initial theme
if (currentTheme === 'dark') {
    document.documentElement.classList.add('dark');
    darkModeIcon.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z');
}

// Toggle function
darkModeToggle.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    
    // Toggle icon
    darkModeIcon.setAttribute('d', isDark ? 
        'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z' : 
        'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z'
    );
});

  </script>
  

</body>
</html>

